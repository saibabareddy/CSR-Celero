<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
 <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.11.0/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.11.0/js/bootstrap-select.min.js"></script>  
<!--<script src="JS/bootstrap-select.js" />--> 


 <style>
            
/*input {padding: 0; margin: 0;}*/
/*td {margin: 0; padding: 0;}*/    
     input {
    width: 100%;
    padding: 0px;
    margin: 0px;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
}       
            
           .box{
 letter-spacing: 3px;
  /*margin-top: 100px;*/
    /*margin-bottom: 100px;*/
    /*margin-right: 80px;*/
    /*margin-left: 80px;*/
background-color:black;
color:white;
font-weight:bolder;
font-size:20px;
height:50px; 
border-bottom: 6px solid red;
/*padding-top: 40px;*/
    /*padding-right: 30px;*/
    /*padding-bottom: 5px;*/
    /*padding-left: 800px;*/
}
            

        </style>    
    </head>
    <body>
        
        <div class="container">
            <form id="tableData" action="ProcessOrder" method="post">
            
            <div class="row">
            <div style="background-color: lightgray;height: 50px"></div>    
            </div>
            
            
             <div class="row">
         
         <!--<div class="col-md-12">-->
         <table class="table">
    <thead>
      <tr>
        <th>Order</th>
        <th>Date</th>
        <th>Due</th>
        <th>Customer</th>
        <th>Discount%</th>
        <th>Qty</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody>
        <tr>
            
            <td><input type="text" class="form-control"></td>
            
             <td><input type="text" class="form-control"></td>
             
              <td><input type="text" class="form-control"></td>
              
               <td><input type="text" class="form-control" ></td>
               
               <td><input type="text" class="form-control"></td>
                
                 <td><input type="text" class="form-control" ></td>
               
                  <td><input type="text" class="form-control"></td>
               
        </tr>
        <tr>
            <td></td>
         <td></td>
          <td></td>
           <td></td>
            <td></td>
             <td></td>
              <td></td>
        
        
        </tr>
        
        
    </tbody>
  </table>
     <!--</div>-->       
         
    </div>
            
            <div class="row">
                
                
                <table class="table" id="itemTable">
    <thead>
        <tr style="background-color: lightgray">
        <th>Style</th>
        <th>Color</th>
        <th>Other</th>
        <th>Size</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Add style variant</th>
      </tr>
    </thead>
    <tbody>
        <tr>
            
            <td class="mainTable" style="vertical-align:middle">DRESS1</td>
            
            <td class="mainTable" style="vertical-align:middle"><select name="COLOR" class="form-control" style="width:220px">
  <option>COLOR</option>   
  <option>RED</option>
  <option>GREEN</option>
  <option>BLUE</option>
  <option>ORANGE</option>
</select></td>
 <td style="vertical-align:middle"><input type="text" class="form-control other" style="width:50px"></td>             
<td class="mainTable">  <table>
  <tr>
      <th style="width:60px;color:gray">Size</th>
    <td style="width:60px">S</td>
    <td style="width:60px">M</td>
    <td style="width:60px">L</td>
    <td style="width:60px">XL</td>
    <td style="width:60px">XXL</td>
  </tr>

  <tr>
    <th style="color:gray">Qty</th>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
  </tr>
  
    <tr>
    <th style="color:gray">Price</th>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    </tr>
</table></td>
  
  <td style="vertical-align:middle"><input type="text" class="form-control qty" style="width:75px"></td>
              
  <td class="mainTable" style="vertical-align:middle"><p class="price"></p></td>              
  <td style="vertical-align:middle" class="addVariant">  <button class="btn btn-default" style="width:35px" type="button" onclick ="appendRow(this,'itemTable')" ><b>+</b></td>             
        </tr>
       
        
        
       <tr>
            
            <td class="mainTable" style="vertical-align:middle">DRESS2</td>
            
            <td class="mainTable" style="vertical-align:middle"><select name="COLOR" class="form-control" style="width:220px">
  <option>COLOR</option>   
  <option>RED</option>
  <option>GREEN</option>
  <option>BLUE</option>
  <option>ORANGE</option>
</select></td>
 <td style="vertical-align:middle"><input type="text" class="form-control other" style="width:50px"></td>             
<td class="mainTable">  <table>
  <tr>
      <th style="width:60px;color:gray">Size</th>
    <td style="width:60px">S</td>
    <td style="width:60px">M</td>
    <td style="width:60px">L</td>
    <td style="width:60px">XL</td>
    <td style="width:60px">XXL</td>
  </tr>

  <tr>
      <th style="color:gray">Qty</th>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
  </tr>
  
    <tr>
    <th style="color:gray">Price</th>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    </tr>
</table></td>
  
  <td style="vertical-align:middle"><input type="text" class="form-control qty" style="width:75px"></td>
              
  <td class="mainTable" style="vertical-align:middle"><p class="price"></p></td>              
   <td style="vertical-align:middle" class="addVariant">  <button class="btn btn-default" style="width:35px" type="button" onclick ="appendRow(this,'itemTable')" ><b>+</b></td>             
        </tr> 
        
        
        <tr>
            
            <td class="mainTable" style="vertical-align:middle">DRESS3</td>
            
            <td class="mainTable" style="vertical-align:middle"><select name="COLOR" class="form-control" style="width:220px">
  <option>COLOR</option>   
  <option>RED</option>
  <option>GREEN</option>
  <option>BLUE</option>
  <option>ORANGE</option>
</select></td>
 <td style="vertical-align:middle"><input type="text" class="form-control other" style="width:50px"></td>             
<td class="mainTable">  <table>
  <tr>
      <th style="width:60px;color:gray">Size</th>
    <td style="width:60px">S</td>
    <td style="width:60px">M</td>
    <td style="width:60px">L</td>
    <td style="width:60px">XL</td>
    <td style="width:60px">XXL</td>
  </tr>

  <tr>
      <th style=";color:gray">Qty</th>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
  </tr>
  
    <tr>
        <th style="color:gray">Price</th>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    </tr>
</table></td>
  
  <td style="vertical-align:middle"><input type="text" class="form-control qty" style="width:75px"></td>
              
  <td class="mainTable" style="vertical-align:middle"><p class="price"></p></td>              
   <td style="vertical-align:middle" class="addVariant">  <button class="btn btn-default" style="width:35px" type="button" onclick ="appendRow(this,'itemTable')" ><b>+</b></td>             
        </tr>
        
        
        
        <tr>
            
            <td class="mainTable" style="vertical-align:middle">DRESS4</td>
            
            <td class="mainTable" style="vertical-align:middle"><select name="COLOR" class="form-control" style="width:220px">
  <option>COLOR</option>   
  <option>RED</option>
  <option>GREEN</option>
  <option>BLUE</option>
  <option>ORANGE</option>
</select></td>
 <td style="vertical-align:middle"><input type="text" class="form-control other" style="width:50px"></td>             
<td class="mainTable"> <table>
  <tr>
      <th style="width:60px ;color:gray">Size</th>
    <td style="width:60px">S</td>
    <td style="width:60px">M</td>
    <td style="width:60px">L</td>
    <td style="width:60px">XL</td>
    <td style="width:60px">XXL</td>
  </tr>

  <tr>
      <th style="color:gray">Qty</th>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
  </tr>
  
    <tr>
        <th style="color:gray">Price</th>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    </tr>
</table></td>
  
  <td style="vertical-align:middle"><input type="text" class="form-control qty" style="width:75px"></td>
              
  <td class="mainTable" style="vertical-align:middle"><p class="price"></p></td>              
   <td style="vertical-align:middle" class="addVariant">  <button class="btn btn-default" style="width:35px" type="button" onclick ="appendRow(this,'itemTable')" ><b>+</b></td>             
        </tr>
        
        
        <tr>
            
            <td class="mainTable" style="vertical-align:middle">DRESS5</td>
            
            <td class="mainTable" style="vertical-align:middle"><select name="COLOR" class="form-control" style="width:220px">
  <option>COLOR</option>   
  <option>RED</option>
  <option>GREEN</option>
  <option>BLUE</option>
  <option>ORANGE</option>
</select></td>
 <td style="vertical-align:middle"><input type="text" class="form-control other" style="width:50px"></td>             
<td class="mainTable">  <table>
  <tr>
      <th style="width:60px;color:gray">Size</th>
    <td style="width:60px">S</td>
    <td style="width:60px">M</td>
    <td style="width:60px">L</td>
    <td style="width:60px">XL</td>
    <td style="width:60px">XXL</td>
  </tr>

  <tr>
    <th style="color:gray">Qty</th>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
    <td><input type="text" class="form-control innerQty" style="width:50px" onkeyup="getValues(this);"></td>
  </tr>
  
    <tr>
        <th style="color:gray">Price</th>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    <td>$40</td>
    </tr>
</table></td>
  
  <td style="vertical-align:middle"><input type="text" class="form-control qty" style="width:75px"></td>
              
  <td  class="mainTable" style="vertical-align:middle"><p class="price"></p></td>              
    <td style="vertical-align:middle" class="addVariant">  <button class="btn btn-default" style="width:35px" type="button" onclick ="appendRow(this,'itemTable')" ><b>+</b></td>             
        </tr>
        
        
        
        <tr>
            <td></td>
             <td></td>
              <td></td>
              
               <td></td>
                <td></td>
                 <td></td>
                  <td></td>
        </tr>
            
    </tbody>
  </table>
                
            </div>    
            
            <div class="row">
                <button type="submit"  class="btn btn-lg btn-primary">Submit Order</button>

            </div>   
            
            </form>
        </div>
        
        
        
        
        <script>

function appendRow(e,tableID) {              //Add style variant
    
    
     var element;
     if(e instanceof jQuery){
        element=e;
      }
     else{
      element=jQuery(e);
      }    
    var currentRow=element.closest('tr');   

   
    var newRow = $(currentRow).clone(true);         //clone current row
                                                    // replace add with delete button
//    var deleteButton='<td style="vertical-align:middle" class="btnDelete"><button class="btn btn-default" type="button" style="width:35px" onclick =""><b>-</b></button></td>';

//    var deleteButton='<td style="vertical-align:middle"><image  class="btnDelete"  src="images/delete4.png"></td>'
   var deleteButton='<td style="vertical-align:middle"><input type="image" src="images/delete4.png"  class="btnDelete" style="width:36px;height:36px" /></td>'

    $(newRow).find('td.addVariant').replaceWith(deleteButton);
    $(newRow).find('td p.price').text("");
    $(newRow).find('td input.qty').val("");
    $(newRow).find('td table td input').val("");
    $(newRow).find('td input.other').val("");
    $(currentRow).after(newRow);                    //insert row after current row
  
    }
    

     function getValues(e) {    //parameter 'this'
               
//                  var ee =jQuery(e);
                 var element;
                 if(e instanceof jQuery){
                     element=e;
                 }
                 else{
                     element=jQuery(e);
                 }
                 
                 
//                 if(element instanceof jQuery){
//                     var x=true;
//                 }
//                 
                 var nestedTable=element.closest('table');                         //get the nested table
                 if(nestedTable instanceof  jQuery){
                   var  x =true;
                 }
                 
                 var y=($(nestedTable).find('td input').eq(0)).val();
//                table.rows[rowIndex].cells[columnIndex]
                  
                  var num1= parseInt(($(nestedTable).find('td input').eq(0)).val());   //get quantities for different sizes
                  var num2=parseInt(($(nestedTable).find('td input').eq(1)).val());
                  var num3=parseInt(($(nestedTable).find('td input').eq(2)).val());
                  var num4=parseInt(($(nestedTable).find('td input').eq(3)).val());
                  var num5=parseInt(($(nestedTable).find('td input').eq(4)).val());
                    

                    num1 = num1 ? num1 : 0;
                    num2 = num2 ? num2 : 0;
                    num3 = num3 ? num3 : 0;
                    num4 = num4 ? num4 : 0;
                    num5 = num5 ? num5 : 0;
                    var totalValue = 40 * num1 + 40 * num2 + 40 * num3 + 40 * num4 + 40 * num5;   // calculate total qty & price
                    var qty1 = num1 + num2 + num3 + num4 + num5;
                    
                    
                   var parentRow = $(nestedTable).parents('tr');                              //get the parent row(row of main table)
                   parentRow.find('.qty').val(qty1);                                          //set total qty
                   parentRow.find('.price').text("$"+totalValue);                                 //set total price



                    if (num1 !== 0) {
                        var pr1= "$" + 40 * num1;
                    (($(nestedTable).find('tr').eq(2)).find('td').eq(0)).text(pr1);
                    }
                    if (num2 !== 0) {

                        var pr2 = "$" + 40 * num2;
                     (($(nestedTable).find('tr').eq(2)).find('td').eq(1)).text(pr2);
                    }
                    if (num3 !== 0) {
                        var pr3 = "$" + 40 * num3;
                        (($(nestedTable).find('tr').eq(2)).find('td').eq(2)).text(pr3);
                    }
                    if (num4 !== 0) {
                        var pr4 = "$" + 40 * num4;
                         (($(nestedTable).find('tr').eq(2)).find('td').eq(3)).text(pr4);
                    }
                    if (num5 !== 0) {
                        var pr5 = "$" + 40 * num5;
                      (($(nestedTable).find('tr').eq(2)).find('td').eq(4)).text(pr5);
                    }

 

        }

$(document).ready(function(){
    
    $('#tableData').submit(function() {
     
        markSelected();
        
       
        var rowItems = [];
      
      
      
       $('#itemTable').find('tr.selected').each(function (rowIndex, r) {    //get row 
//        var cols = [];
        var sizeQtyChart=[];
        var color,style,totalPrice;
        $(this).find('td.mainTable').each(function (colIndex, c) {     //get column
          
            
         if(colIndex===0){
             
            
//             cols.push({style:c.textContent});               //get style
             style=c.textContent;
             
        }
        
        
        
        if(colIndex===1){                              // get COLOR
            color=$(this).find("select").val();
            if(color===undefined){
                color="";
            }
//            cols.push({color:color});
          }
          
          else if(colIndex===2){                                   //get sizeQtyChart
              var sizes=[];
              var qtys=[];
              var prices=[];
              var me=$(this).text();
              $(this).find('tr').each(function(rIndex,r){
                  
                  $(this).find('td').each(function(cIndex,c){
                      
                      if(rIndex===0){
                          sizes[cIndex]=c.textContent;
                      }
                      
                      if(rIndex===1){
                          qtys[cIndex]=$(this).find(".innerQty").val();
                      }
                      
                      if(rIndex===2){
                          prices[cIndex]=c.textContent;
                      }
                      
                  });
                  
              });
              var i=0;
//              var sizeQtyChart=[];
              for(i=0;i<qtys.length;i++){
                  if(qtys[i]!=="" && qtys[i]!==undefined){
                      
//                     var temp= new Object();
//                     
//                     temp["size"] = sizes[i];
//                     temp["qty"] = qtys[i];
//                     temp["price"] = prices[i];
                      var temp={size:sizes[i],qty:qtys[i],price:prices[i]};

                      sizeQtyChart.push(temp);
                  }
              }
              
//              cols.push(sizeQtyChart);
          }
          
          
          
          
        else if(colIndex===3){                       //get totalPrice
            
            totalPrice=c.textContent;
//          cols.push({totalPrice:c.textContent});
        }
        
//        
       
      
        });
        var rowItem={style:style,color:color,sizeQtyChart:sizeQtyChart,totalPrice:totalPrice};
        
       rowItems.push(rowItem);
    });
     
     
     
     //Now filter data create JSON of SKU-Items
     
     
   var SKUitems=[];
   var j=0;
   for(j=0;j<rowItems.length;j++){
         
         
         var x=0;
         var rowItem=rowItems[j];
         var sizeQtyChart=rowItem.sizeQtyChart;
         
        for(x=0;x<sizeQtyChart.length;x++){
           var size= sizeQtyChart[x].size;
           var qty=sizeQtyChart[x].qty;
           var SKU=rowItem.style+"-"+rowItem.color+"-"+size;
           var SKUitem={SKU:SKU,qty:qty};
           SKUitems.push(SKUitem);
        }
   }
     
     
        $('<input type="hidden" name="json"/>').val(JSON.stringify(SKUitems)).appendTo('#tableData');
     
     
      });
      
      
      
      
      
       

      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
 });
 
 function markSelected(){
     
      $('#itemTable').find('.qty').each(function (rowIndex, r) {
          
         var markValue=$(this).val();
         
         if(markValue!=="" && markValue!==undefined){
             
             $(this).closest('tr').addClass("selected");
         }
          
      });
 }
 
 
 
        </script>
        
         
         <script>
            $(document).ready(function () {
               
                $("#itemTable").on('click', '.btnDelete', function (event) {
                     event.stopPropagation();
                    if (confirm("Do you want to delete?")) {
                        this.click;
                          $(this).closest('tr').remove();
                    } else
                    {
                      
                    }
                    event.preventDefault();
                   
                });

            });

        </script>

        
        
        
    </body>
</html>
